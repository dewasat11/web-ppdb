<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard - PPDSB Pondok Pesantren Al Ikhsan Beji</title>

  <!-- Prevent Caching - Force fresh page load -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <parameter name="Expires" content="0" />

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"/>

  <!-- Toastr CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css"/>

  <style>
    :root{
      --primary-gradient:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      --success-gradient:linear-gradient(135deg,#0f9d58 0%,#0a7a43 100%);
      --danger-gradient:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);
      --warning-gradient:linear-gradient(135deg,#ffecd2 0%,#fcb69f 100%);
      --info-gradient:linear-gradient(135deg,#4facfe 0%,#00f2fe 100%);
      --sidebar-gradient:linear-gradient(180deg,#1e3c72 0%,#2a5298 100%);
    }
    body{background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);font-family:"Segoe UI",Tahoma,Geneva,Verdana,sans-serif;}

    /* Sidebar */
    .sidebar{min-height:100vh;background:var(--sidebar-gradient);color:#fff;box-shadow:4px 0 20px rgba(0,0,0,.1);}
    .sidebar-header{padding:25px 20px;background:rgba(255,255,255,.1);border-bottom:1px solid rgba(255,255,255,.1);}
    .sidebar-header h5{font-weight:700;letter-spacing:1px;margin:0;}
    .sidebar .nav-link{color:rgba(255,255,255,.85);padding:15px 20px;margin:5px 10px;border-radius:12px;border-left:4px solid transparent;transition:.3s;font-weight:500;}
    .sidebar .nav-link:hover{color:#fff;background:rgba(255,255,255,.15);border-left-color:#fff;transform:translateX(5px);}
    .sidebar .nav-link.active{color:#fff;background:rgba(255,255,255,.2);border-left-color:#fff;box-shadow:0 4px 15px rgba(0,0,0,.2);}
    .sidebar .nav-link i{margin-right:12px;font-size:1.2rem;width:25px;text-align:center;}
    .user-badge{background:rgba(255,255,255,.15);padding:10px 15px;border-radius:10px;margin:10px;color:#fff;font-weight:600;}
    .user-badge i{margin-right:8px;}

    /* Layout */
    .content-area{padding:30px;min-height:100vh;}
    .page-header{margin-bottom:30px;padding:20px;background:#fff;border-radius:15px;box-shadow:0 2px 15px rgba(0,0,0,.08);}
    .page-header h2{color:#2a5298;font-weight:700;margin:0;}
    .page-header p{color:#6c757d;margin:5px 0 0;}

    /* Cards / Stats */
    .stat-card{border:none;border-radius:15px;padding:25px;margin-bottom:20px;box-shadow:0 5px 20px rgba(0,0,0,.1);transition:.3s;background:#fff;position:relative;overflow:hidden;animation:fadeInUp .5s ease;}
    .stat-card::before{content:"";position:absolute;top:0;left:0;width:5px;height:100%;background:var(--primary-gradient);}
    .stat-card:hover{transform:translateY(-5px);box-shadow:0 10px 30px rgba(0,0,0,.15);}
    .stat-card.success::before{background:var(--success-gradient);}
    .stat-card.danger::before{background:var(--danger-gradient);}
    .stat-card.warning::before{background:var(--warning-gradient);}
    .stat-card.info::before{background:var(--info-gradient);}
    .stat-card .icon-box{width:60px;height:60px;border-radius:15px;display:flex;align-items:center;justify-content:center;font-size:1.8rem;margin-bottom:15px;color:#fff;}
    .stat-card.success .icon-box{background:linear-gradient(135deg,#0f9d58 0%,#0a7a43 100%);}
    .stat-card.danger .icon-box{background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);}
    .stat-card.warning .icon-box{background:linear-gradient(135deg,#ffa726 0%,#fb8c00 100%);}
    .stat-card.info .icon-box{background:linear-gradient(135deg,#4facfe 0%,#00f2fe 100%);}
    .stat-card.primary .icon-box{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);}
    .stat-card h6{color:#6c757d;font-weight:600;font-size:.9rem;text-transform:uppercase;letter-spacing:.5px;margin:10px 0;}
    .stat-card h3{color:#2a5298;font-weight:700;font-size:2rem;margin:0;}
    .stat-card small{color:#28a745;font-weight:600;}

    /* Tabs */
    .nav-tabs{border:none;background:#fff;padding:10px;border-radius:15px;box-shadow:0 2px 15px rgba(0,0,0,.08);margin-bottom:25px;}
    .nav-tabs .nav-link{border:none;color:#6c757d;padding:12px 25px;margin:0 5px;border-radius:10px;font-weight:600;transition:.3s;}
    .nav-tabs .nav-link:hover{color:#2a5298;background:#f0f4ff;}
    .nav-tabs .nav-link.active{color:#fff;background:var(--primary-gradient);box-shadow:0 4px 15px rgba(102,126,234,.4);}
    .nav-tabs .nav-link i{margin-right:8px;font-size:1.1rem;}

    /* Table & Cards */
    .card{border:none;border-radius:15px;box-shadow:0 2px 15px rgba(0,0,0,.08);margin-bottom:20px;}
    .card-header{background:var(--primary-gradient);color:#fff;border-radius:15px 15px 0 0 !important;padding:20px;font-weight:600;}
    .table{background:#fff;border-radius:15px;overflow:hidden;}
    .table thead{background:var(--primary-gradient);color:#fff;}
    .table thead th{border:none;padding:15px;font-weight:600;text-transform:uppercase;font-size:.85rem;letter-spacing:.5px;}
    .table tbody td{padding:15px;vertical-align:middle;border-bottom:1px solid #f0f0f0;}
    .table tbody tr{transition:.3s;}
    .table tbody tr:hover{background:#f8f9ff;transform:scale(1.01);}
    .table-actions button{margin:0 3px;border-radius:8px;padding:8px 15px;font-weight:500;transition:.3s;}

    /* Buttons & Badges */
    .btn{border-radius:10px;padding:10px 20px;font-weight:600;border:none;transition:.3s;}
    .btn-primary{background:var(--primary-gradient);box-shadow:0 4px 15px rgba(102,126,234,.4);}
    .btn-primary:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(102,126,234,.6);}
    .btn-success{background:var(--success-gradient);box-shadow:0 4px 15px rgba(15,157,88,.4);}
    .btn-success:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(15,157,88,.6);}
    .btn-danger{background:var(--danger-gradient);box-shadow:0 4px 15px rgba(245,87,108,.4);}
    .btn-danger:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(245,87,108,.6);}
    .btn-warning{background:linear-gradient(135deg,#ffa726 0%,#fb8c00 100%);color:#fff;box-shadow:0 4px 15px rgba(255,167,38,.4);}
    .btn-warning:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(255,167,38,.6);}
    .btn-info{background:var(--info-gradient);box-shadow:0 4px 15px rgba(79,172,254,.4);}
    .btn-info:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(79,172,254,.6);}

    .badge{padding:8px 15px;border-radius:8px;font-weight:600;font-size:.8rem;}
    .badge.bg-success{background:var(--success-gradient)!important;}
    .badge.bg-danger{background:var(--danger-gradient)!important;}
    .badge.bg-warning{background:linear-gradient(135deg,#ffa726 0%,#fb8c00 100%)!important;}
    .badge.bg-info{background:var(--info-gradient)!important;}

    /* Modal */
    .modal-header{background:var(--primary-gradient);color:#fff;border-radius:15px 15px 0 0;}
    .modal-content{border-radius:15px;border:none;box-shadow:0 10px 40px rgba(0,0,0,.2);}
    .modal-header .btn-close{filter:brightness(0) invert(1);}
    .preview-img{max-width:100px;max-height:100px;object-fit:cover;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.1);}

    /* Forms */
    .form-control,.form-select{border-radius:10px;border:2px solid #e0e0e0;padding:10px 15px;transition:.3s;}
    .form-control:focus,.form-select:focus{border-color:#667eea;box-shadow:0 0 0 .2rem rgba(102,126,234,.25);}
    .alert{border-radius:12px;border:none;padding:15px 20px;box-shadow:0 2px 10px rgba(0,0,0,.1);}

    /* Fixed Bottom-Right Buttons */
    .fixed-bottom-buttons{
      position:fixed;
      bottom:20px;
      right:20px;
      z-index:1030;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .fixed-bottom-buttons .btn{
      min-width:120px;
      padding:10px 20px;
      border-radius:10px;
      font-weight:600;
      box-shadow:0 4px 15px rgba(0,0,0,.2);
      transition:.3s;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
    }
    .fixed-bottom-buttons .btn:hover{
      transform:translateY(-3px);
      box-shadow:0 6px 25px rgba(0,0,0,.3);
    }
    .fixed-bottom-buttons .btn-outline-light{
      background:rgba(255,255,255,.95);
      color:#2a5298;
      border:2px solid #2a5298;
    }
    .fixed-bottom-buttons .btn-outline-light:hover{
      background:#2a5298;
      color:#fff;
    }
    .fixed-bottom-buttons .btn-danger{
      background:linear-gradient(135deg,#f5576c 0%,#f093fb 100%);
      border:none;
    }

    /* ============================================
       RESPONSIVE DESIGN (Mobile-First Approach)
       ============================================ */
    
    /* Mobile Menu Toggle Button */
    .mobile-menu-toggle{
      display:none;
      position:fixed;
      top:15px;
      left:15px;
      z-index:1040;
      background:var(--success-gradient);
      color:#fff;
      border:none;
      padding:12px 18px;
      border-radius:10px;
      box-shadow:0 4px 15px rgba(0,0,0,.3);
      font-weight:600;
      transition:.3s;
    }
    .mobile-menu-toggle:hover{
      transform:translateY(-2px);
      box-shadow:0 6px 20px rgba(0,0,0,.4);
    }
    
    /* Sidebar Overlay for Mobile */
    .sidebar-overlay{
      display:none;
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.6);
      z-index:1040;
      backdrop-filter:blur(2px);
    }
    
    /* ============================================
       TABLET & MOBILE (< 992px)
       ============================================ */
    @media (max-width:991px){
      /* Sidebar: Fixed & Hidden by Default */
      .sidebar{
        position:fixed;
        left:-280px;
        top:0;
        z-index:1050;
        width:280px!important;
        transition:left .3s ease;
        box-shadow:4px 0 30px rgba(0,0,0,.3);
      }
      .sidebar.show{left:0;}
      .sidebar-overlay.show{display:block;}
      
      /* Show Mobile Menu Toggle */
      .mobile-menu-toggle{display:block;}
      
      /* Content Area: Full Width */
      .content-area{
        padding:20px 15px;
        width:100%;
        margin-left:0!important;
      }
      
      /* Page Header */
      .page-header{
        flex-direction:column!important;
        align-items:flex-start!important;
        gap:15px;
        padding:15px;
      }
      .page-header h2{font-size:1.5rem;}
      .page-header p{font-size:.9rem;}
      
      /* Stat Cards */
      .stat-card{
        padding:20px 15px;
        margin-bottom:15px;
      }
      .stat-card h6{font-size:.8rem;}
      .stat-card h3{font-size:1.5rem;}
      .stat-card .icon-box{
        width:55px;
        height:55px;
        font-size:1.6rem;
      }
      
      /* Navigation Tabs */
      .nav-tabs{
        padding:8px;
        overflow-x:auto;
        white-space:nowrap;
        -webkit-overflow-scrolling:touch;
      }
      .nav-tabs .nav-link{
        padding:10px 15px;
        font-size:.85rem;
        margin:0 3px;
        white-space:nowrap;
      }
      .nav-tabs .nav-link i{font-size:1rem;}
      
      /* Buttons */
      .btn{
        padding:10px 16px;
        font-size:.9rem;
      }
      
      /* Table Actions */
      .table-actions{
        display:flex;
        flex-direction:column;
        gap:8px;
        width:100%;
      }
      .table-actions button,
      .table-actions .btn{
        width:100%;
        padding:8px 12px;
        font-size:.85rem;
      }
      
      /* Cards */
      .card{margin-bottom:15px;}
      .card-header{padding:15px;font-size:.95rem;}
      
      /* Modal */
      .modal-dialog{
        margin:10px;
        max-width:calc(100% - 20px);
      }
      
      /* Forms */
      .form-control,
      .form-select{
        font-size:.9rem;
      }
    }
    
    /* ============================================
       MOBILE ONLY (< 768px)
       ============================================ */
    @media (max-width:767px){
      /* Sidebar: Narrower */
      .sidebar{
        width:260px!important;
        left:-260px;
      }
      
      /* Content Area: Minimal Padding */
      .content-area{padding:70px 10px 15px;}
      
      /* Page Header: Smaller */
      .page-header{padding:12px;}
      .page-header h2{font-size:1.3rem;}
      .page-header p{font-size:.85rem;margin-top:5px;}
      
      /* Stat Cards: Even Smaller */
      .stat-card{padding:15px 12px;}
      .stat-card h6{font-size:.7rem;}
      .stat-card h3{font-size:1.3rem;}
      .stat-card .icon-box{
        width:45px;
        height:45px;
        font-size:1.4rem;
      }
      .stat-card small{font-size:.75rem;}
      
      /* Tables: Mobile-Optimized */
      .table{font-size:.85rem;}
      .table thead th{
        padding:10px 8px;
        font-size:.75rem;
      }
      .table tbody td{
        padding:10px 8px;
        font-size:.85rem;
      }
      
      /* Table: Hide Less Important Columns on Small Screens */
      .table th:nth-child(5),
      .table td:nth-child(5){display:none;}
      
      /* Table Responsive: Horizontal Scroll */
      .table-responsive{
        border-radius:10px;
        box-shadow:inset 0 0 0 1px #e0e0e0;
      }
      
      /* Navigation Tabs: Smaller */
      .nav-tabs .nav-link{
        padding:8px 12px;
        font-size:.8rem;
      }
      
      /* Buttons: Stack & Full Width */
      .d-flex.gap-2{
        flex-direction:column!important;
        gap:10px!important;
      }
      .d-flex.gap-2 .btn{
        width:100%;
        justify-content:center;
      }
      
      /* Modal: Full Screen */
      .modal-dialog{
        margin:0;
        max-width:100%;
        height:100%;
      }
      .modal-content{
        height:100%;
        border-radius:0;
      }
      
      /* Forms: Full Width */
      .form-row,
      .row{margin:0 -5px;}
      .form-row > *,
      .row > *{padding:0 5px;}
      
      /* Badge: Smaller */
      .badge{
        padding:6px 10px;
        font-size:.7rem;
      }
      
      /* Gelombang Management: Stack Forms */
      #gelombangContainer .card{margin-bottom:15px;}
      #gelombangContainer .form-group{margin-bottom:12px;}
      #gelombangContainer label{font-size:.85rem;}
      #gelombangContainer .btn{
        width:100%;
        margin-top:10px;
      }
    }
    
    /* ============================================
       EXTRA SMALL MOBILE (< 576px)
       ============================================ */
    @media (max-width:575px){
      /* Mobile Toggle: Smaller */
      .mobile-menu-toggle{
        padding:10px 14px;
        font-size:.85rem;
      }
      
      /* Sidebar: Even Narrower */
      .sidebar{
        width:240px!important;
        left:-240px;
      }
      .sidebar-header h5{font-size:1rem;}
      .sidebar .nav-link{
        padding:12px 15px;
        font-size:.85rem;
      }
      .sidebar .nav-link i{
        font-size:1rem;
        width:20px;
      }
      
      /* Content Area */
      .content-area{padding:65px 8px 12px;}
      
      /* Page Header */
      .page-header{padding:10px;}
      .page-header h2{font-size:1.2rem;}
      .page-header p{font-size:.8rem;}
      
      /* Stat Cards: Grid 2 Columns */
      .stat-card{padding:12px 10px;}
      .stat-card h6{font-size:.65rem;}
      .stat-card h3{font-size:1.1rem;}
      .stat-card .icon-box{
        width:40px;
        height:40px;
        font-size:1.2rem;
        margin-bottom:10px;
      }
      .stat-card small{font-size:.7rem;}
      
      /* Tables: Ultra Compact */
      .table{font-size:.75rem;}
      .table thead th{
        padding:8px 6px;
        font-size:.7rem;
      }
      .table tbody td{
        padding:8px 6px;
        font-size:.75rem;
      }
      
      /* Hide More Columns on Extra Small Screens */
      .table th:nth-child(2),
      .table td:nth-child(2){display:none;}
      
      /* Navigation Tabs: Minimal */
      .nav-tabs{padding:6px;}
      .nav-tabs .nav-link{
        padding:8px 10px;
        font-size:.75rem;
      }
      .nav-tabs .nav-link i{display:none;}
      
      /* Buttons: Compact */
      .btn{
        padding:8px 12px;
        font-size:.85rem;
      }
      
      /* Modal: Full Screen */
      .modal-body{padding:15px;}
      .modal-header{padding:12px 15px;}
      .modal-footer{padding:10px 15px;}
      
      /* Forms: Compact */
      .form-control,
      .form-select{
        padding:8px 12px;
        font-size:.85rem;
      }
      .form-label{font-size:.85rem;}
      
      /* Alert: Compact */
      .alert{
        padding:10px 15px;
        font-size:.85rem;
      }
    }
    
    /* ============================================
       LANDSCAPE MOBILE (Small Height)
       ============================================ */
    @media (max-height:600px) and (max-width:991px){
      .sidebar{max-height:100vh;overflow-y:auto;}
      .modal-dialog{margin:5px;}
      .modal-content{max-height:calc(100vh - 10px);overflow-y:auto;}
    }
    
    /* ============================================
       COMPONENT-SPECIFIC RESPONSIVE RULES
       ============================================ */
    
    /* Statistics Cards - Pondok Sections */
    @media (max-width:767px){
      .col-md-4{
        flex:0 0 100%;
        max-width:100%;
      }
      .card-body .d-flex{
        font-size:.9rem;
      }
      .card-body .badge{
        min-width:45px;
      }
    }
    
    /* Table Action Buttons - Stack on Mobile */
    @media (max-width:767px){
      table .btn-sm{
        padding:6px 10px;
        font-size:.75rem;
        margin:2px 0;
      }
      table .dropdown-menu{
        font-size:.85rem;
      }
    }
    
    /* Modal Detail Pendaftar - Optimize for Mobile */
    @media (max-width:767px){
      #modalDetail .modal-body img{
        max-width:80px!important;
        max-height:80px!important;
      }
      #modalDetail dl dt,
      #modalDetail dl dd{
        font-size:.85rem;
      }
      #modalDetail .col-sm-4,
      #modalDetail .col-sm-8{
        flex:0 0 100%;
        max-width:100%;
      }
    }
    
    /* Pembayaran Table - Mobile View */
    @media (max-width:767px){
      #pembayaranTable img{
        max-width:60px!important;
        max-height:60px!important;
      }
    }
    
    /* Kelola Gelombang - Form Optimization */
    @media (max-width:767px){
      #gelombangContainer .row{
        margin:0;
      }
      #gelombangContainer .col-md-6,
      #gelombangContainer .col-md-4{
        flex:0 0 100%;
        max-width:100%;
        padding:0 0 10px;
      }
      #gelombangContainer .d-flex.gap-2{
        flex-direction:column!important;
      }
      #gelombangContainer .form-check{
        margin:10px 0;
      }
    }
    
    /* Top Action Buttons - Stack on Mobile */
    @media (max-width:767px){
      .d-flex.justify-content-between{
        flex-direction:column!important;
        align-items:flex-start!important;
        gap:12px;
      }
      .d-flex.justify-content-between h5{
        font-size:1rem;
      }
    }
    
    /* Hide Desktop-Only Elements on Mobile */
    @media (max-width:575px){
      .desktop-only{display:none!important;}
    }
    
    /* Show Mobile-Only Elements */
    .mobile-only{display:none!important;}
    @media (max-width:767px){
      .mobile-only{display:block!important;}
    }
    
    /* Fixed Bottom Buttons - Mobile Responsive */
    @media (max-width:767px){
      .fixed-bottom-buttons{
        bottom:15px;
        right:15px;
      }
      .fixed-bottom-buttons .btn{
        min-width:100px;
        padding:8px 15px;
        font-size:.85rem;
      }
    }
    @media (max-width:575px){
      .fixed-bottom-buttons{
        bottom:10px;
        right:10px;
        gap:8px;
      }
      .fixed-bottom-buttons .btn{
        min-width:90px;
        padding:8px 12px;
        font-size:.8rem;
      }
      .fixed-bottom-buttons .btn i{
        font-size:.9rem;
      }
    }
    
    /* Utility: Touch-Friendly Tap Targets (44x44px minimum) */
    @media (max-width:991px){
      .btn,
      .nav-link,
      .table-actions button{
        min-height:44px;
        display:inline-flex;
        align-items:center;
        justify-content:center;
      }
    }
    
    /* ============================================
       CLICK FEEDBACK & PERFORMANCE
       ============================================ */
    
    /* Button click feedback - instant visual response */
    .btn:active,
    .nav-link:active{
      transform:scale(0.98)!important;
      opacity:0.8;
      transition:all 0.1s ease!important;
    }
    
    /* Disable pointer events during loading to prevent double-click */
    .loading-state{
      pointer-events:none;
      opacity:0.6;
      cursor:wait!important;
    }
    
    /* Show loading cursor during heavy operations */
    body.loading *{
      cursor:wait!important;
    }

    /* Animation */
    @keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    .stat-card:nth-child(1){animation-delay:.1s;}
    .stat-card:nth-child(2){animation-delay:.2s;}
    .stat-card:nth-child(3){animation-delay:.3s;}
    .stat-card:nth-child(4){animation-delay:.4s;}
    
    /* Pulse Animation for Activated Gelombang */
    @keyframes pulse{
      0%{transform:scale(1);box-shadow:0 2px 15px rgba(0,0,0,.08);}
      50%{transform:scale(1.02);box-shadow:0 8px 30px rgba(15,157,88,.4);}
      100%{transform:scale(1);box-shadow:0 2px 15px rgba(0,0,0,.08);}
    }
  </style>
</head>
<body>
  <!-- Mobile Menu Toggle -->
  <button class="mobile-menu-toggle" onclick="toggleSidebar()">
    <i class="bi bi-list"></i> Menu
  </button>

  <!-- Sidebar Overlay -->
  <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

  <div class="d-flex">
    <!-- Sidebar -->
    <aside class="sidebar p-0" style="width:250px" id="sidebar">
      <div class="sidebar-header">
        <h5 class="text-white mb-1"><i class="bi bi-shield-lock-fill"></i> Admin Panel</h5>
        <small style="opacity:.8">PONDOK PESANTREN AL IKHSAN</small>
      </div>

      <div class="user-badge">
        <i class="bi bi-person-circle"></i>
        <span id="adminEmail">Admin</span>
      </div>

      <ul class="nav flex-column px-2 mt-3">
        <li class="nav-item">
          <a class="nav-link active" href="#" data-tab="pendaftar" onclick="switchTab('pendaftar')">
            <i class="bi bi-people-fill"></i> Data Pendaftar
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" data-tab="statistik" onclick="switchTab('statistik')">
            <i class="bi bi-bar-chart-fill"></i> Statistik
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" data-tab="pembayaran" onclick="switchTab('pembayaran')">
            <i class="bi bi-credit-card-fill"></i> Pembayaran
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#" data-tab="gelombang" onclick="switchTab('gelombang')">
            <i class="bi bi-calendar-range"></i> Kelola Gelombang
          </a>
        </li>
      </ul>

    </aside>

    <!-- Main Content -->
    <main class="flex-grow-1">
      <section class="content-area">
        <!-- Tab: Pendaftar -->
        <div id="tab-pendaftar" class="tab-content active">
          <div class="page-header d-flex justify-content-between align-items-center">
            <div>
              <h2><i class="bi bi-people-fill"></i> Data Pendaftar</h2>
              <p>Kelola data pendaftar Pondok Pesantren Al Ikhsan Beji</p>
            </div>
            <span id="updateTimePendaftar" class="badge bg-info text-dark">
              <i class="bi bi-clock-history"></i> Data update: -
            </span>
          </div>

          <div class="row g-3 mb-4">
            <div class="col-6 col-md-3">
              <div class="card stat-card primary">
                <div class="card-body">
                  <div class="icon-box"><i class="bi bi-people-fill"></i></div>
                  <h6>Total Pendaftar</h6>
                  <h3 id="totalCount">0</h3>
                  <small><i class="bi bi-arrow-up"></i> Semua data</small>
                </div>
              </div>
            </div>
            <div class="col-6 col-md-3">
              <div class="card stat-card warning">
                <div class="card-body">
                  <div class="icon-box"><i class="bi bi-hourglass-split"></i></div>
                  <h6>Pending</h6>
                  <h3 id="pendingCount">0</h3>
                  <small><i class="bi bi-clock"></i> Menunggu</small>
                </div>
              </div>
            </div>
            <div class="col-6 col-md-3">
              <div class="card stat-card info">
                <div class="card-body">
                  <div class="icon-box"><i class="bi bi-pencil-square"></i></div>
                  <h6>Revisi</h6>
                  <h3 id="revisiCount">0</h3>
                  <small><i class="bi bi-arrow-repeat"></i> Perlu diperbaiki</small>
                </div>
              </div>
            </div>
            <div class="col-6 col-md-3">
              <div class="card stat-card success">
                <div class="card-body">
                  <div class="icon-box"><i class="bi bi-check-circle-fill"></i></div>
                  <h6>Diterima</h6>
                  <h3 id="diterimaCount">0</h3>
                  <small><i class="bi bi-trophy"></i> Berhasil</small>
                </div>
              </div>
            </div>
            <div class="col-6 col-md-3">
              <div class="card stat-card danger">
                <div class="card-body">
                  <div class="icon-box"><i class="bi bi-x-circle-fill"></i></div>
                  <h6>Ditolak</h6>
                  <h3 id="ditolakCount">0</h3>
                  <small><i class="bi bi-exclamation-triangle"></i> Tidak lolos</small>
                </div>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0"><i class="bi bi-table"></i> Tabel Data Pendaftar</h5>
            <div class="d-flex gap-2">
              <!-- Download ZIP Button -->
              <button class="btn btn-primary" onclick="downloadAllZip()" title="Download semua berkas dalam 1 file ZIP">
                <i class="bi bi-file-earmark-zip"></i> Download Semua Berkas (ZIP)
              </button>
              
              <!-- Excel Export Button -->
              <button class="btn btn-success" onclick="exportToExcel()" title="Export ke Excel (.xlsx)">
                <i class="bi bi-file-earmark-excel"></i> Download Excel
            </button>
            </div>
          </div>

          <div class="card">
            <div class="card-body">
              <!-- Pagination Info (Top) -->
              <div class="d-flex justify-content-between align-items-center mb-3">
                <div>
                  <span class="text-muted" id="paginationInfo">Menampilkan data...</span>
                </div>
                <div>
                  <span class="badge bg-secondary">10 data per halaman</span>
                </div>
              </div>

              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>NISN</th>
                      <th>Nama</th>
                      <th>Status</th>
                      <th>Tanggal</th>
                      <th>Aksi</th>
                    </tr>
                  </thead>
                  <tbody id="pendaftarTable">
                    <tr><td colspan="6" class="text-center">Loading...</td></tr>
                  </tbody>
                </table>
              </div>

              <!-- Pagination Controls (Bottom) -->
              <div class="d-flex justify-content-between align-items-center mt-3">
                <div>
                  <button id="btnPrevPage" class="btn btn-outline-secondary btn-sm" onclick="previousPage()" disabled>
                    <i class="bi bi-chevron-left"></i> Previous
                  </button>
                  <button id="btnNextPage" class="btn btn-outline-secondary btn-sm" onclick="nextPage()" disabled>
                    Next <i class="bi bi-chevron-right"></i>
                  </button>
                </div>
                <div>
                  <span class="text-muted" id="pageInfo">Halaman 1</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tab: Statistik -->
        <div id="tab-statistik" class="tab-content" style="display:none">
          <div class="page-header d-flex justify-content-between align-items-center">
            <div>
              <h2><i class="bi bi-bar-chart-fill"></i> Statistik Pendaftaran</h2>
              <p>Statistik jumlah pendaftar Pondok Pesantren Al Ikhsan Beji berdasarkan kategori</p>
            </div>
            <span id="updateTimeStatistik" class="badge bg-info text-dark">
              <i class="bi bi-clock-history"></i> Data update: -
            </span>
          </div>

          <div class="row g-4">
            <!-- Putra Induk -->
            <div class="col-md-4">
              <div class="card">
                <div class="card-header" style="background:var(--primary-gradient)">
                  <h5 class="mb-0 text-white"><i class="bi bi-building-fill"></i> Pondok Putra Induk</h5>
                </div>
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                    <span><i class="bi bi-book"></i> MTs (Tsanawiyah)</span>
                    <span class="badge bg-info fs-6" id="putraIndukMts">0</span>
                  </div>
                  <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                    <span><i class="bi bi-book-half"></i> MA (Aliyah)</span>
                    <span class="badge bg-info fs-6" id="putraIndukMa">0</span>
                  </div>
                  <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                    <span><i class="bi bi-mortarboard"></i> Kuliah</span>
                    <span class="badge bg-info fs-6" id="putraIndukKuliah">0</span>
                  </div>
                  <div class="d-flex justify-content-between align-items-center mt-3 pt-3 border-top">
                    <strong>Total Pendaftar</strong>
                    <strong><span class="badge bg-primary fs-5" id="putraIndukTotal">0</span></strong>
                  </div>
                </div>
              </div>
            </div>

            <!-- Putra Tahfidz -->
            <div class="col-md-4">
              <div class="card">
                <div class="card-header" style="background:var(--success-gradient)">
                  <h5 class="mb-0 text-white"><i class="bi bi-journal-bookmark-fill"></i> Pondok Putra Tahfidz</h5>
                </div>
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                    <span>MTs (Tsanawiyah)</span>
                    <span class="badge bg-info fs-6" id="putraTahfidzMts">0</span>
                  </div>
                  <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                    <span>MA (Aliyah)</span>
                    <span class="badge bg-info fs-6" id="putraTahfidzMa">0</span>
                  </div>
                  <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                    <span>Kuliah</span>
                    <span class="badge bg-info fs-6" id="putraTahfidzKuliah">0</span>
                  </div>
                  <div class="d-flex justify-content-between align-items-center mt-3 pt-3 border-top">
                    <strong>Total Pendaftar</strong>
                    <strong><span class="badge bg-success fs-5" id="putraTahfidzTotal">0</span></strong>
                  </div>
                </div>
              </div>
            </div>

            <!-- Putri -->
            <div class="col-md-4">
              <div class="card">
                <div class="card-header" style="background:var(--danger-gradient)">
                  <h5 class="mb-0 text-white"><i class="bi bi-person-hearts"></i> Pondok Putri</h5>
                </div>
                <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                    <span>MTs (Tsanawiyah)</span>
                    <span class="badge bg-info fs-6" id="putriMts">0</span>
                  </div>
                  <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                    <span>MA (Aliyah)</span>
                    <span class="badge bg-info fs-6" id="putriMa">0</span>
                  </div>
                  <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom">
                    <span>Kuliah</span>
                    <span class="badge bg-info fs-6" id="putriKuliah">0</span>
                  </div>
                  <div class="d-flex justify-content-between align-items-center mt-3 pt-3 border-top">
                    <strong>Total Pendaftar</strong>
                    <strong><span class="badge bg-danger fs-5" id="putriTotal">0</span></strong>
                  </div>
                </div>
              </div>
            </div>

            <!-- Hanya Sekolah -->
            <div class="col-md-4">
              <div class="card">
                <div class="card-header" style="background:linear-gradient(135deg,#ffa726 0%,#fb8c00 100%)">
                  <h5 class="mb-0 text-white"><i class="bi bi-mortarboard-fill"></i> Hanya Sekolah</h5>
                </div>
                <div class="card-body">
                  <h6 class="mb-3" style="color:#2a5298;font-weight:600"><i class="bi bi-book"></i> MTs (Tsanawiyah)</h6>
                  <div class="d-flex justify-content-between align-items-center mb-2 ps-3">
                    <span style="color:#495057;font-weight:500"><i class="bi bi-gender-male text-primary"></i> Laki-laki</span>
                    <span class="badge bg-primary" id="hanyaSekolahMtsL">0</span>
                  </div>
                  <div class="d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom ps-3">
                    <span style="color:#495057;font-weight:500"><i class="bi bi-gender-female text-danger"></i> Perempuan</span>
                    <span class="badge bg-danger" id="hanyaSekolahMtsP">0</span>
                  </div>

                  <h6 class="mb-3" style="color:#2a5298;font-weight:600"><i class="bi bi-book-half"></i> MA (Aliyah)</h6>
                  <div class="d-flex justify-content-between align-items-center mb-2 ps-3">
                    <span style="color:#495057;font-weight:500"><i class="bi bi-gender-male text-primary"></i> Laki-laki</span>
                    <span class="badge bg-primary" id="hanyaSekolahMaL">0</span>
                  </div>
                  <div class="d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom ps-3">
                    <span style="color:#495057;font-weight:500"><i class="bi bi-gender-female text-danger"></i> Perempuan</span>
                    <span class="badge bg-danger" id="hanyaSekolahMaP">0</span>
                  </div>

                  <div class="d-flex justify-content-between align-items-center mt-3 pt-3 border-top">
                    <strong style="color:#2a5298">Total Pendaftar</strong>
                    <strong><span class="badge bg-warning text-dark fs-5" id="hanyaSekolahTotal">0</span></strong>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tab: Pembayaran -->
        <div id="tab-pembayaran" class="tab-content" style="display:none">
          <div class="page-header d-flex justify-content-between align-items-center">
            <div>
              <h2><i class="bi bi-credit-card-fill"></i> Data Pembayaran</h2>
              <p>Kelola data pembayaran dan verifikasi
                <span class="badge bg-success ms-2"><i class="bi bi-arrow-repeat"></i> Auto Refresh 30s</span>
              </p>
            </div>
            <span id="updateTimePembayaran" class="badge bg-info text-dark">
              <i class="bi bi-clock-history"></i> Data update: -
            </span>
          </div>

          <div class="row mb-4 g-3">
            <div class="col-md-3">
              <div class="card stat-card warning">
                <div class="card-body">
                  <div class="icon-box"><i class="bi bi-hourglass-split"></i></div>
                  <h6>Pending</h6>
                  <h3 id="statPending">0</h3>
                  <small><i class="bi bi-clock"></i> Menunggu verifikasi</small>
                </div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card stat-card success">
                <div class="card-body">
                  <div class="icon-box"><i class="bi bi-check-circle-fill"></i></div>
                  <h6>Verified</h6>
                  <h3 id="statVerified">0</h3>
                  <small><i class="bi bi-shield-check"></i> Terverifikasi</small>
                </div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card stat-card danger">
                <div class="card-body">
                  <div class="icon-box"><i class="bi bi-x-circle-fill"></i></div>
                  <h6>Rejected</h6>
                  <h3 id="statRejected">0</h3>
                  <small><i class="bi bi-exclamation-triangle"></i> Ditolak</small>
                </div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card stat-card primary">
                <div class="card-body">
                  <div class="icon-box"><i class="bi bi-currency-dollar"></i></div>
                  <h6>Total Revenue</h6>
                  <h3 class="mb-0" id="statRevenue">Rp 0</h3>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>No</th>
                      <th>NISN</th>
                      <th>Nama Lengkap</th>
                      <th>Jumlah</th>
                      <th>Status</th>
                      <th>Tanggal Upload</th>
                      <th>Aksi</th>
                    </tr>
                  </thead>
                  <tbody id="pembayaranTableBody">
                    <tr>
                      <td colspan="7" class="text-center">
                        <div class="spinner-border text-primary" role="status">
                          <span class="visually-hidden">Loading...</span>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Tab: Kelola Gelombang -->
        <div id="tab-gelombang" class="tab-content" style="display:none">
          <div class="page-header">
            <h2><i class="bi bi-calendar-range"></i> Kelola Gelombang Pendaftaran</h2>
            <p>Atur tanggal, tahun ajaran, dan status aktif untuk setiap gelombang pendaftaran</p>
          </div>

          <div id="gelombangContainer">
            <!-- Loading state -->
            <div class="text-center py-5">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Memuat...</span>
              </div>
              <p class="text-muted mt-3">Memuat data gelombang...</p>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Fixed Bottom-Right Buttons -->
  <div class="fixed-bottom-buttons">
    <a href="/" class="btn btn-outline-light btn-sm mb-2" title="Kembali ke Website">
      <i class="bi bi-house-fill"></i> Website
    </a>
    <button class="btn btn-danger btn-sm" onclick="logout()" title="Logout">
      <i class="bi bi-box-arrow-right"></i> Logout
    </button>
  </div>

  <!-- Modal: Detail Pendaftar -->
  <div class="modal fade" id="detailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="bi bi-person-badge"></i> Detail Pendaftar</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
        </div>
        <div class="modal-body">
          <div id="detailContent"><!-- populated by JS --></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Verifikasi Pendaftar -->
  <div class="modal fade" id="verifikasiModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="verifikasiModalTitle">Verifikasi Pendaftar</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
        </div>
        <div class="modal-body">
          <form id="verifikasiForm">
            <input type="hidden" id="verifikasi-id"/>
            <input type="hidden" id="verifikasi-status"/>

            <div class="mb-3">
              <label class="form-label">Status Verifikasi</label>
              <input type="text" class="form-control" id="verifikasi-status-display" readonly/>
            </div>

            <div class="mb-3" id="catatanContainer">
              <label class="form-label" id="catatanLabel">Catatan</label>
              <textarea class="form-control" id="verifikasi-catatan" rows="4" placeholder="Masukkan catatan..."></textarea>
              <small class="text-muted">Opsional: Berikan alasan atau catatan untuk keputusan ini</small>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
          <button type="button" class="btn btn-primary" onclick="confirmVerifikasi()" id="btnConfirmVerifikasi">Konfirmasi</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Detail Pembayaran -->
  <div class="modal fade" id="detailPembayaranModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="bi bi-credit-card"></i> Detail Pembayaran</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <table class="table table-borderless">
                <tr><th width="40%">NISN:</th><td id="detail-nisn"></td></tr>
                <tr><th>Nama Lengkap:</th><td id="detail-nama-lengkap"></td></tr>
                <tr><th>Jumlah:</th><td id="detail-jumlah"></td></tr>
                <tr><th>Metode:</th><td id="detail-metode"></td></tr>
                <tr><th>Status:</th><td id="detail-status"></td></tr>
                <tr><th>Tanggal Upload:</th><td id="detail-tanggal-upload"></td></tr>
                <tr><th>Tanggal Verifikasi:</th><td id="detail-tanggal-verifikasi"></td></tr>
                <tr><th>Verified By:</th><td id="detail-verified-by"></td></tr>
                <tr><th>Catatan Admin:</th><td id="detail-catatan-admin"></td></tr>
              </table>
            </div>
            <div class="col-md-6">
              <h6 class="mb-3">Bukti Pembayaran:</h6>
              <div class="text-center">
                <img id="detail-bukti-img" src="" alt="Bukti Pembayaran" class="img-fluid rounded shadow"
                     style="max-height:400px;cursor:pointer" onclick="window.open(this.src,'_blank')"/>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kembali</button>
          <button type="button" class="btn btn-success" onclick="openVerifikasiPembayaran('VERIFIED')" id="btnVerifyPayment">
            <i class="bi bi-check-circle"></i> Terima
          </button>
          <button type="button" class="btn btn-danger" onclick="openVerifikasiPembayaran('REJECTED')" id="btnRejectPayment">
            <i class="bi bi-x-circle"></i> Tolak
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Konfirmasi Verifikasi Pembayaran -->
  <div class="modal fade" id="verifikasiPembayaranModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="verifikasiPembayaranTitle">Konfirmasi Verifikasi</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="verify-nisn"/>
          <input type="hidden" id="verify-status"/>

          <div class="mb-3">
            <label class="form-label">Catatan Admin:</label>
            <textarea class="form-control" id="verify-catatan" rows="3" placeholder="Masukkan catatan (opsional)"></textarea>
          </div>

          <div class="alert" id="verify-alert" role="alert" style="display:none"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
          <button type="button" class="btn btn-primary" onclick="confirmVerifikasiPembayaran()" id="btnConfirmVerifyPayment">Konfirmasi</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS & App Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- Toastr CSS & JS for notifications (MUST load before admin.js) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
  
  <!-- Toastr Configuration & Fallback -->
  <script>
    // Ensure toastr is available (fallback to alert if CDN fails)
    if (typeof toastr === "undefined") {
      console.warn("[TOASTR] CDN failed to load, using alert fallback");
      window.toastr = {
        info: function(msg) { alert("‚ÑπÔ∏è " + msg); },
        success: function(msg) { alert("‚úÖ " + msg); },
        error: function(msg) { alert("‚ùå " + msg); },
        warning: function(msg) { alert("‚ö†Ô∏è " + msg); }
      };
    } else {
      // Configure toastr options
      toastr.options = {
        closeButton: true,
        progressBar: true,
        positionClass: "toast-bottom-right",
        timeOut: "2500",
        extendedTimeOut: "1000",
        showEasing: "swing",
        hideEasing: "linear",
        showMethod: "fadeIn",
        hideMethod: "fadeOut"
      };
      console.log("[TOASTR] Initialized successfully");
    }
  </script>
  
  <!-- Supabase Client for Gelombang Management -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    
    // Supabase credentials (already set by user)
    const SUPABASE_URL = 'https://sxbvadzcwpaovkhghttv.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN4YnZhZHpjd3Bhb3ZraGdodHR2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExMDg4MDYsImV4cCI6MjA3NjY4NDgwNn0.miJeKmsNgjgS4fWegGlwrxF_cPUoZBT0YKl1oxmmXTE';
    
    // Initialize Supabase client
    window.supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    
    console.log('[SUPABASE ADMIN] ‚úÖ Client initialized successfully');
    console.log('[SUPABASE ADMIN] ‚Üí URL:', SUPABASE_URL);
    console.log('[SUPABASE ADMIN] ‚Üí Ready for gelombang management');
    
    // ===== REAL-TIME SYNC: Listen to gelombang changes from other admin tabs =====
    const channel = window.supabase
      .channel('admin-gelombang-sync')
      .on('postgres_changes', { 
        event: '*', 
        schema: 'public', 
        table: 'gelombang' 
      }, (payload) => {
        console.log('[SUPABASE ADMIN] üîÑ Gelombang data changed from another source:', payload);
        
        // Check if current tab is on gelombang tab
        const gelombangTab = document.getElementById('tab-gelombang');
        if (gelombangTab && gelombangTab.style.display !== 'none') {
          console.log('[SUPABASE ADMIN] üîÑ Reloading gelombang data (real-time sync)...');
          
          // Show subtle notification
          if (typeof toastr !== 'undefined' && toastr.info) {
            toastr.info('Data gelombang diperbarui dari sumber lain');
          }
          
          // Reload data with slight delay
          setTimeout(() => {
            if (typeof loadGelombangData === 'function') {
              loadGelombangData(true);
            }
          }, 500);
        }
      })
      .subscribe((status) => {
        if (status === 'SUBSCRIBED') {
          console.log('[SUPABASE ADMIN] üéß Subscribed to real-time gelombang updates');
        } else if (status === 'CLOSED') {
          console.log('[SUPABASE ADMIN] ‚ö†Ô∏è Real-time connection closed');
        } else if (status === 'CHANNEL_ERROR') {
          console.error('[SUPABASE ADMIN] ‚ùå Real-time connection error');
        }
      });
    
    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      console.log('[SUPABASE ADMIN] üîå Unsubscribing from real-time updates');
      window.supabase.removeChannel(channel);
    });
  </script>
  
  <!-- Client-side ZIP generation removed - now using server-side download -->
  
  <!-- AUTH GUARD - Must be logged in to access admin panel -->
  <script>
      // ===== SIMPLE AUTHENTICATION CHECK WITH localStorage =====
      // Check if user is logged in using localStorage (persists across refresh)
      const isLoggedIn = localStorage.getItem("isAdminLoggedIn");
      
      if (isLoggedIn !== "true") {
        console.log("[ADMIN] ‚ùå Not authenticated - redirecting to login");
        window.location.href = "/login.html";
      } else {
        const adminEmail = localStorage.getItem("adminEmail");
        const loginTimestamp = localStorage.getItem("loginTimestamp");
        console.log("[ADMIN] ‚úÖ User authenticated:", adminEmail);
        console.log("[ADMIN] ‚úÖ Login time:", loginTimestamp ? new Date(parseInt(loginTimestamp)).toLocaleString() : 'N/A');
      }
    
    /**
     * Logout Function
     * Clears localStorage and redirects to login
     */
    function logout() {
      console.log("[ADMIN] Logging out...");
      
      // Clear all login data from localStorage
      localStorage.removeItem("isAdminLoggedIn");
      localStorage.removeItem("adminEmail");
      localStorage.removeItem("loginTimestamp");
      
      alert("‚úÖ Anda telah logout.\n\nSilakan login kembali untuk mengakses admin panel.");
      
      // Redirect to login page
      window.location.href = "/login.html";
    }
  </script>
  
  <!-- Responsive Mobile Menu Toggle Script -->
  <script>
    /**
     * Toggle Sidebar on Mobile
     * Shows/hides sidebar menu with overlay
     */
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.querySelector('.sidebar-overlay');
      
      if (sidebar && overlay) {
        const isVisible = sidebar.classList.contains('show');
        
        if (isVisible) {
          // Hide sidebar
          sidebar.classList.remove('show');
          overlay.classList.remove('show');
          document.body.style.overflow = ''; // Enable body scroll
        } else {
          // Show sidebar
          sidebar.classList.add('show');
          overlay.classList.add('show');
          document.body.style.overflow = 'hidden'; // Prevent body scroll
        }
      }
    }
    
    /**
     * Close sidebar when clicking nav links on mobile
     */
    document.addEventListener('DOMContentLoaded', function() {
      const navLinks = document.querySelectorAll('.sidebar .nav-link');
      
      navLinks.forEach(link => {
        link.addEventListener('click', function() {
          // Close sidebar on mobile after clicking nav link
          if (window.innerWidth < 992) {
            setTimeout(() => {
              toggleSidebar();
            }, 200); // Small delay for smooth transition
          }
        });
      });
      
      // Handle window resize - close sidebar if resized to desktop
      let resizeTimer;
      window.addEventListener('resize', function() {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function() {
          if (window.innerWidth >= 992) {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            if (sidebar && overlay) {
              sidebar.classList.remove('show');
              overlay.classList.remove('show');
              document.body.style.overflow = '';
            }
          }
        }, 250);
      });
    });
  </script>
  
  <!-- Page Loading Overlay -->
  <div id="pageLoadingOverlay" style="position:fixed;inset:0;background:rgba(255,255,255,0.95);z-index:9999;display:flex;align-items:center;justify-content:center;flex-direction:column">
    <div class="spinner-border text-primary" role="status" style="width:4rem;height:4rem;border-width:0.4rem">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 text-muted fw-bold">Memuat Dashboard Admin...</p>
    <p class="text-muted" style="font-size:0.85rem">Mohon tunggu sebentar</p>
  </div>
  
  <!-- Admin JS (load last, after all dependencies) - Async to prevent blocking -->
  <script defer src="/assets/js/admin.js"></script>
  
  <!-- DEBUG: Test if admin.js loaded successfully -->
  <script>
    // Wait for admin.js to load (defer means it loads after DOM ready)
    window.addEventListener('load', function() {
      setTimeout(function() {
        // Check critical exposed functions
        const criticalFunctions = ['lihatDetail', 'exportToExcel', 'downloadAllZip', 'switchTab'];
        const missingFunctions = criticalFunctions.filter(fn => typeof window[fn] === 'undefined');
        
        if (missingFunctions.length > 0) {
          console.error('‚ùå CRITICAL: admin.js failed to load or has syntax error!');
          console.error('‚ùå Missing functions:', missingFunctions);
          alert('‚ö†Ô∏è ERROR: JavaScript gagal load!\n\nMissing: ' + missingFunctions.join(', ') + '\n\nSilakan:\n1. Hard refresh (Ctrl+Shift+R)\n2. Clear browser cache\n3. Check console untuk error');
        } else {
          console.log('‚úÖ admin.js loaded successfully');
          console.log('‚úÖ All critical functions exist:', criticalFunctions);
        }
      }, 1000);
    });
  </script>
  
  <!-- Hide loading overlay after page fully loaded -->
  <script>
    window.addEventListener('load', function() {
      console.log("[ADMIN] ‚úÖ Page fully loaded, hiding overlay...");
      const overlay = document.getElementById('pageLoadingOverlay');
      if (overlay) {
        setTimeout(() => {
          overlay.style.opacity = '0';
          overlay.style.transition = 'opacity 0.3s ease';
          setTimeout(() => {
            overlay.style.display = 'none';
            console.log("[ADMIN] ‚úÖ Ready!");
          }, 300);
        }, 500);
      }
    });
  </script>
</body>
</html>
