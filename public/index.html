<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="csrf-token" content="{{CSRF_TOKEN}}" />
  <meta name="description" content="PPDSB Pondok Pesantren Al Ikhsan Beji. Penerimaan Peserta Didik dan Santri Baru tahun ajaran 2026/2027. Pendidikan islami terpadu dengan akhlak dan prestasi." />
  <meta name="keywords" content="PPDSB, Penerimaan Santri Baru, Pondok Pesantren Al Ikhsan Beji, pendaftaran santri, pesantren, Beji" />

  <link rel="preconnect" href="https://fonts.gstatic.com" />
  <!-- TODO: Ganti favicon/logo di bawah dengan aset milik pesantren -->
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" href="/favicon.png" sizes="32x32">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">

  <title>Beranda - PPDSB Pondok Pesantren Al Ikhsan Beji</title>

  <!-- Tailwind CSS (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Optional: Tailwind config tweak
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              50: '#ecfdf5',
              100: '#d1fae5',
              200: '#a7f3d0',
              300: '#6ee7b7',
              400: '#34d399',
              500: '#10b981', // emerald
              600: '#059669',
              700: '#047857',
              800: '#065f46',
              900: '#064e3b',
            }
          }
        }
      }
    }
  </script>

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />

  <!-- Choices.js / Flatpickr / Toastify (opsional, kompatibel dgn snippet lama) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" />

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet" />

  <style>
    :root {
      --tw-font-sans: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
    }
    html, body { font-family: var(--tw-font-sans); }
    [x-cloak] { display: none !important; }

    /* ===== RESPONSIVE ENHANCEMENTS ===== */
    
    /* Mobile-first responsive typography */
    @media (max-width: 640px) {
      h1 { font-size: 1.875rem !important; line-height: 2.25rem !important; }
      h2 { font-size: 1.5rem !important; line-height: 2rem !important; }
      h3 { font-size: 1.25rem !important; line-height: 1.75rem !important; }
      .text-lg { font-size: 1rem !important; line-height: 1.5rem !important; }
      .text-xl { font-size: 1.125rem !important; line-height: 1.75rem !important; }
    }

    /* Navbar responsive improvements */
    @media (max-width: 768px) {
      .navbar-brand span {
        font-size: 0.875rem !important;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
    }

    /* Hero section responsive */
    @media (max-width: 640px) {
      .hero-content {
        padding: 1.5rem 1rem !important;
      }
      section.relative.min-h-\[45vh\] {
        min-height: 40vh !important;
      }
      
      /* Adjust hero text size on mobile */
      section.relative h1 {
        font-size: 1.5rem !important;
        line-height: 2rem !important;
        margin-bottom: 1rem !important;
      }
      
      section.relative p {
        font-size: 0.9rem !important;
        line-height: 1.4rem !important;
        margin-bottom: 1.5rem !important;
      }
      
      /* Adjust buttons on mobile */
      section.relative a {
        padding: 0.625rem 1.25rem !important;
        font-size: 0.875rem !important;
      }
    }
    
    /* Tablet adjustments */
    @media (min-width: 641px) and (max-width: 1024px) {
      section.relative h1 {
        font-size: 2.25rem !important;
        line-height: 2.75rem !important;
      }
    }
    
    /* Better text readability on hero */
    .hero-text-shadow {
      text-shadow: 2px 4px 8px rgba(0,0,0,0.4);
    }

    /* Gelombang cards responsive stacking */
    @media (max-width: 768px) {
      #gelombangContainer {
        grid-template-columns: 1fr !important;
      }
    }

    /* WhatsApp widget responsive */
    @media (max-width: 640px) {
      .whatsapp-widget {
        padding: 0.75rem 1rem !important;
        font-size: 0.875rem !important;
      }
      .whatsapp-widget .flex-col span:first-child {
        font-size: 0.75rem !important;
      }
      .whatsapp-widget .flex-col span:last-child {
        font-size: 0.625rem !important;
      }
    }

    /* Card hover effects - disable on touch devices */
    @media (hover: none) {
      .hover\:-translate-y-2:hover {
        transform: none !important;
      }
    }

    /* Smooth transitions */
    * {
      -webkit-tap-highlight-color: transparent;
    }

    /* Improve button touch targets on mobile */
    @media (max-width: 640px) {
      a, button {
        min-height: 44px;
        min-width: 44px;
      }
    }

    /* Container responsive padding */
    @media (max-width: 640px) {
      .container {
        padding-left: 1rem !important;
        padding-right: 1rem !important;
      }
    }

    /* Mobile menu improvements */
    @media (max-width: 768px) {
      .mobile-menu {
        max-width: 280px;
        width: 85vw;
      }
    }

    /* ===== IMAGE SLIDER STYLES (Card Minimalis dengan Slide Animation) ===== */
    #imageSliderContainer {
      position: relative;
      width: 100%;
      max-width: 1000px;
      margin: 0 auto;
      padding: 1.5rem 1rem;
      height: 380px; /* Ukuran dikecilkan */
    }

    #imageSlider {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
      background: #f5f5f5;
    }

    .slider-track {
      display: flex;
      width: 100%;
      height: 100%;
      transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      will-change: transform;
    }

    .slider-slide {
      min-width: 100%;
      width: 100%;
      height: 100%;
      flex-shrink: 0;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    /* Mobile responsive */
    @media (max-width: 768px) {
      #imageSliderContainer {
        height: 280px;
        padding: 1rem;
      }
    }

    @media (max-width: 640px) {
      #imageSliderContainer {
        height: 220px;
        padding: 0.75rem;
      }
      
      #imageSlider {
        border-radius: 12px;
      }
    }
  </style>
</head>

<body class="min-h-screen flex flex-col bg-white text-gray-800">
  <!-- NAVBAR -->
  <nav class="bg-white shadow-lg sticky top-0 z-50" x-data="{ mobileMenuOpen: false, profileDropdownOpen: false }">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <!-- Logo -->
        <div class="flex-shrink-0 flex items-center">
          <a href="/" class="flex items-center">
            <!-- TODO: ganti src logo -->
            <img src="/assets/img/logo-alikhsan.png" class="h-16 w-auto" />
          </a>
        </div>

        <!-- Desktop Navigation -->
        <div class="hidden md:block">
          <div class="flex items-baseline space-x-4">
            <a href="/" class="text-brand-700 px-3 py-2 rounded-md text-sm font-medium">Beranda</a>

            <!-- Dropdown Informasi -->
            <div class="relative">
              <button @click="profileDropdownOpen=!profileDropdownOpen" class="text-gray-600 hover:text-brand-600 px-3 py-2 rounded-md text-sm font-medium flex items-center">
                Informasi
                <i class="bi bi-caret-down-fill ml-1 text-xs" :class="{'rotate-180': profileDropdownOpen}"></i>
              </button>
              <div x-cloak x-show="profileDropdownOpen" @click.outside="profileDropdownOpen=false" x-transition class="absolute right-0 mt-2 w-56 bg-white rounded-md shadow-lg py-2 z-50 border border-gray-100">
                <a href="/alur-pendaftaran.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">Alur Pendaftaran</a>
                <a href="/syarat-pendaftaran.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">Syarat Pendaftaran</a>
                <a href="/biaya.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">Biaya</a>
              </div>
            </div>

            <a href="/brosur.html" class="text-gray-600 hover:text-brand-600 px-3 py-2 rounded-md text-sm font-medium">Brosur</a>
            <a href="/kontak.html" class="text-gray-600 hover:text-brand-600 px-3 py-2 rounded-md text-sm font-medium">Kontak</a>
          </div>
        </div>

        <!-- CTA Button Desktop -->
        <div class="hidden md:block">
          <a href="/login" class="bg-brand-700 hover:bg-brand-800 text-white px-6 py-2 rounded-lg text-sm font-medium shadow-md hover:shadow-lg">Admin</a>
        </div>

        <!-- Mobile menu button -->
        <div class="md:hidden">
          <button @click="mobileMenuOpen=!mobileMenuOpen" class="inline-flex items-center justify-center p-2 rounded-md text-gray-600 hover:text-brand-600 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-brand-500">
            <i class="bi" :class="mobileMenuOpen ? 'bi-x-lg' : 'bi-list'"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile Backdrop -->
    <div x-cloak x-show="mobileMenuOpen" @click="mobileMenuOpen=false" class="md:hidden fixed inset-0 z-40 bg-black/50"></div>

    <!-- Mobile Menu -->
    <div x-cloak x-show="mobileMenuOpen" x-transition class="md:hidden fixed inset-y-0 left-0 z-50 mobile-menu bg-white shadow-xl border-r border-gray-200 overflow-y-auto">
      <div class="flex items-center justify-between p-4 border-b border-gray-200">
        <div class="flex items-center">
          <img src="/assets/img/logo-alikhsan.png" class="h-16 w-auto" />
        </div>
        <button @click="mobileMenuOpen=false" class="p-2 rounded-md text-gray-500 hover:text-gray-700 hover:bg-gray-100"><i class="bi bi-x-lg"></i></button>
      </div>

      <div class="px-2 pt-4 pb-3 space-y-1">
        <a href="/" class="bg-brand-100 text-brand-700 block px-3 py-2 rounded-md text-base font-medium">Beranda</a>

        <details class="px-1">
          <summary class="cursor-pointer text-gray-700 hover:text-brand-700 hover:bg-gray-50 px-3 py-2 rounded-md text-base font-medium">Informasi</summary>
          <div class="pl-6 space-y-1 mt-2">
            <a href="/alur-pendaftaran.html" class="block px-3 py-2 text-sm rounded-md hover:bg-gray-50">Alur Pendaftaran</a>
            <a href="/syarat-pendaftaran.html" class="block px-3 py-2 text-sm rounded-md hover:bg-gray-50">Syarat Pendaftaran</a>
            <a href="/biaya.html" class="block px-3 py-2 text-sm rounded-md hover:bg-gray-50">Biaya</a>
          </div>
        </details>

        <a href="/brosur.html" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-50">Brosur</a>
        <a href="/kontak.html" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-gray-50">Kontak</a>

        <div class="pt-4 pb-2 px-2">
          <a href="/login.html" class="w-full bg-brand-700 hover:bg-brand-800 text-white px-4 py-3 rounded-lg text-base font-medium shadow-md hover:shadow-lg block text-center">Admin</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- MAIN -->
  <main class="flex-1">
    <!-- HERO -->
    <section class="relative min-h-[45vh] md:min-h-[55vh] flex items-center justify-center overflow-hidden" style="background: linear-gradient(135deg, #047857 0%, #064e3b 100%);">
      <!-- Content - Centered Vertically and Horizontally -->
      <div class="relative z-20 w-full h-full flex items-center justify-center">
        <div class="container mx-auto px-4 py-8 md:py-10">
          <div class="w-full flex flex-col items-center justify-center text-center">
            <div class="inline-flex items-center bg-white text-brand-700 mb-4 px-4 py-1.5 rounded-lg font-medium shadow-lg text-sm">
              <i class="bi bi-calendar-event mr-2"></i> Tahun Ajaran 2026/2027
            </div>
            <h1 class="text-3xl lg:text-5xl font-bold text-white mb-4 leading-tight max-w-5xl" style="text-shadow: 2px 4px 8px rgba(0,0,0,0.4);">
              <span class="text-yellow-400" style="text-shadow: 2px 4px 8px rgba(0,0,0,0.5);">Penerimaan Peserta Didik dan Santri Baru</span><br/>
              (PPDSB) PONDOK PESANTREN AL IKHSAN BEJI
            </h1>
            <div class="max-w-3xl mx-auto mb-6">
              <p class="text-base lg:text-lg text-white leading-relaxed" style="text-shadow: 1px 2px 6px rgba(0,0,0,0.4);">
                Bergabunglah menjadi santri Pondok Pesantren Al Ikhsan Beji. Pendidikan islami terpadu dengan pembinaan akhlak, tahfidz Al-Qur'an, dan ilmu pengetahuan yang membentuk generasi Qur'ani dan berprestasi.
              </p>
            </div>
            <div class="flex flex-col sm:flex-row gap-3 justify-center">
              <a href="/daftar.html" class="inline-block bg-yellow-400 hover:bg-yellow-500 text-brand-900 font-bold px-6 py-3 rounded-lg shadow-lg hover:shadow-xl transition transform hover:scale-105 text-sm lg:text-base">
                <i class="bi bi-pencil-square mr-2"></i> Daftar Sekarang
              </a>
              <a href="/cek-status.html" class="inline-block bg-white/20 hover:bg-white/30 backdrop-blur-sm border-2 border-white text-white font-semibold px-6 py-3 rounded-lg shadow-lg hover:shadow-xl transition text-sm lg:text-base">
                <i class="bi bi-search mr-2"></i> Cek Status
              </a>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- IMAGE SLIDER SECTION (Card Minimalis - Slide Animation) -->
    <section class="py-8 bg-gray-50">
      <div id="imageSliderContainer">
        <div id="imageSlider">
          <div id="sliderTrack" class="slider-track">
            <!-- Fallback gradient -->
            <div id="sliderFallback" class="slider-slide" style="background: linear-gradient(135deg, #047857 0%, #064e3b 100%);"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- WHY SECTION (Modern 2-Column Layout) -->
    <section class="py-16 bg-white">
      <div class="container mx-auto px-4">
        <div class="max-w-6xl mx-auto">
          <div id="whySectionContent" class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 items-center">
            <!-- Loading state -->
            <div class="animate-pulse lg:col-span-2">
              <div class="h-8 bg-gray-200 rounded mb-4 max-w-md"></div>
              <div class="h-4 bg-gray-200 rounded mb-2 max-w-xl"></div>
              <div class="h-4 bg-gray-200 rounded mb-6 max-w-lg"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- GELOMBANG PENDAFTARAN -->
    <section class="py-12 bg-gray-50">
      <div class="container mx-auto px-4">
        <div class="flex justify-center mb-12">
          <div class="w-full lg:w-2/3 text-center">
            <h2 class="text-3xl lg:text-4xl font-bold mb-3 text-gray-800">Gelombang Pendaftaran</h2>
            <p class="text-lg text-gray-600">Pilih gelombang sesuai jadwal keluarga Anda</p>
          </div>
        </div>

        <!-- Dynamic Gelombang Cards -->
        <div id="gelombangContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
          <!-- Loading skeleton -->
          <div class="text-center py-12 col-span-full">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Memuat data gelombang...</span>
            </div>
            <p class="text-gray-500 mt-3">Memuat data gelombang...</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="bg-white text-gray-600 py-6 shadow-2xl border-t border-gray-200 mt-auto">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <p class="text-sm">&copy; 2025 Pondok Pesantren Al Ikhsan Beji. All rights reserved. <span class="hidden sm:inline">Development by Tim IT Pesantren</span></p>
    </div>
  </footer>

  <!-- WhatsApp Widget (Floating) -->
  <!-- TODO: Ganti nomor WA di href sesuai kontak resmi pesantren -->
  <div class="fixed bottom-4 right-4 sm:bottom-6 sm:right-6 z-50">
    <a
      href="https://wa.me/6281218768593?text=Assalamualaikum,%20saya%20ingin%20menanyakan%20informasi%20PPDSB%20Pondok%20Pesantren%20Al%20Ikhsan%20Beji"
      target="_blank"
      class="whatsapp-widget flex items-center bg-green-500 hover:bg-green-600 text-white rounded-full shadow-lg hover:shadow-xl px-3 py-2 sm:px-4 sm:py-3 transition-all">
      <div class="flex items-center justify-center w-6 h-6 sm:w-8 sm:h-8 mr-2 sm:mr-3">
        <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.515" />
        </svg>
      </div>
      <div class="flex flex-col hidden sm:flex">
        <span class="text-sm font-semibold">Butuh Bantuan?</span>
        <span class="text-xs">Chat Admin PPDSB</span>
      </div>
    </a>
  </div>

  <!-- Vendors JS (optional) -->
  <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <script>
    // Shim toastr -> toastify agar kompatibel dgn snippet lama
    window.toastr = {
      success(msg){ Toastify({ text: msg, duration: 4000, close: true, gravity: 'top', position: 'right', style: { background: '#10b981', color: '#fff' }}).showToast(); },
      error(msg){ Toastify({ text: msg, duration: 4000, close: true, gravity: 'top', position: 'right', style: { background: '#ef4444', color: '#fff' }}).showToast(); },
      warning(msg){ Toastify({ text: msg, duration: 4000, close: true, gravity: 'top', position: 'right', style: { background: '#f59e0b', color: '#fff' }}).showToast(); },
      info(msg){ Toastify({ text: msg, duration: 4000, close: true, gravity: 'top', position: 'right', style: { background: '#3b82f6', color: '#fff' }}).showToast(); }
    }
  </script>

  <!-- Alpine.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

  <!-- Gelombang Data Loader (Business Logic: Active-based Status) -->
  <script>
    /* ===== UI MAPPING ===== */
    const UI = {
      label: {
        ACTIVE: "Pendaftaran Dibuka",
        UPCOMING: "Segera Dibuka",
        CLOSED: "Ditutup",
        NOT_ACTIVE: "Belum Aktif",
      },
      color: {
        ACTIVE: "green",
        UPCOMING: "blue",
        CLOSED: "gray",
        NOT_ACTIVE: "gray",
      }
    };

    /**
     * Decorate gelombang dengan status berdasarkan activeId
     * KONDISI BISNIS:
     * - Jika Gelombang 1 AKTIF → Gelombang 2 & 3 = "Segera Dibuka"
     * - Jika Gelombang 2 AKTIF → Gelombang 1 = "Ditutup", Gelombang 3 = "Segera Dibuka"
     * - Jika Gelombang 3 AKTIF → Gelombang 1 & 2 = "Ditutup"
     * - TIDAK pakai logika tanggal untuk label
     */
    function decorateGelombang(waves, activeId) {
      const byId = Object.fromEntries(waves.map(w => [w.id, w]));

      function setState(id, stateKey) {
        const w = byId[id]; 
        if (!w) return;
        w._state = stateKey;
        w._label = UI.label[stateKey];
        w._color = UI.color[stateKey];
      }

      // Default semua "NOT_ACTIVE"
      waves.forEach(w => setState(w.id, "NOT_ACTIVE"));

      // Aturan bisnis
      if (activeId === 1) {
        setState(1, "ACTIVE");
        setState(2, "UPCOMING");
        setState(3, "UPCOMING");
      } else if (activeId === 2) {
        setState(2, "ACTIVE");
        setState(1, "CLOSED");
        setState(3, "UPCOMING");
      } else if (activeId === 3) {
        setState(3, "ACTIVE");
        setState(1, "CLOSED");
        setState(2, "CLOSED");
      }

      return waves;
    }
    
    /**
     * Fetch and render ALL 3 gelombang dengan status berdasarkan active gelombang
     */
    async function loadGelombangAktif() {
      try {
        const container = document.getElementById('gelombangContainer');
        
        // 1) Fetch all gelombang (3 waves)
        const cacheBuster = new Date().getTime();
        const listResponse = await fetch(`/api/get_gelombang_list?_t=${cacheBuster}`);
        const listResult = await listResponse.json();
        
        console.log('[GELOMBANG_LIST] API Response:', listResult);
        
        if (!listResult.ok || !listResult.data || listResult.data.length === 0) {
          console.log('[GELOMBANG_LIST] No gelombang data found');
          container.innerHTML = `
            <div class="text-center py-12 col-span-full">
              <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <i class="bi bi-calendar-x text-gray-400 text-3xl"></i>
              </div>
              <h3 class="text-xl font-semibold text-gray-700 mb-2">Belum Ada Data Gelombang</h3>
              <p class="text-gray-500">Silakan tunggu informasi lebih lanjut.</p>
            </div>
          `;
          return;
        }
        
        // 2) Fetch active gelombang ID
        let activeId = null;
        try {
          const activeResponse = await fetch(`/api/gelombang_active?_t=${cacheBuster}`);
          const activeResult = await activeResponse.json();
          if (activeResult.ok && activeResult.data && typeof activeResult.data.id === "number") {
            activeId = activeResult.data.id;
            console.log('[GELOMBANG_ACTIVE] Active ID:', activeId);
          }
        } catch (e) {
          console.warn('[GELOMBANG_ACTIVE] Failed to fetch active gelombang:', e);
        }
        
        // 3) Decorate gelombang with business logic
        const gelombangList = decorateGelombang(listResult.data, activeId);
        
        console.log('[GELOMBANG_LIST] Rendering', gelombangList.length, 'gelombang with activeId:', activeId);
        
        // Map colors to CSS classes
        const colorMap = {
          green: {
            border: 'border-green-200',
            badge: 'bg-green-500',
            icon: 'bg-gradient-to-br from-green-500 to-green-600',
            iconText: 'text-green-500'
          },
          blue: {
            border: 'border-blue-200',
            badge: 'bg-blue-500',
            icon: 'bg-gradient-to-br from-blue-500 to-blue-600',
            iconText: 'text-blue-500'
          },
          gray: {
            border: 'border-gray-200',
            badge: 'bg-gray-500',
            icon: 'bg-gradient-to-br from-gray-500 to-gray-600',
            iconText: 'text-gray-500'
          }
        };
        
        // 4) Generate HTML for all gelombang cards
        let cardsHTML = '';
        
        gelombangList.forEach(gelombang => {
          const colors = colorMap[gelombang._color] || colorMap.gray;
          
          console.log('[GELOMBANG_LIST] Rendering:', gelombang.nama, '| state:', gelombang._state, '| label:', gelombang._label);
          
          // Determine button state based on _state
          let buttonHTML = '';
          let statusHTML = '';
          
          if (gelombang._state === 'ACTIVE') {
            buttonHTML = `<a href="/daftar.html" class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-6 rounded-lg inline-block text-center transition shadow-md hover:shadow-lg">
              <i class="bi bi-pencil-square mr-2"></i>Daftar Sekarang
            </a>`;
            statusHTML = `<div class="bg-green-50 rounded-lg p-3 mb-4"><p class="text-sm text-green-700 font-medium">✓ Pendaftaran Dibuka</p></div>`;
          } else if (gelombang._state === 'UPCOMING') {
            buttonHTML = `<button class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg cursor-default" disabled>
              <i class="bi bi-clock mr-2"></i>Segera Dibuka
            </button>`;
            statusHTML = `<div class="bg-blue-50 rounded-lg p-3 mb-4"><p class="text-sm text-blue-700 font-medium">📅 Segera Dibuka</p></div>`;
          } else if (gelombang._state === 'CLOSED') {
            buttonHTML = `<button class="w-full bg-gray-300 text-gray-600 cursor-not-allowed font-semibold py-3 px-6 rounded-lg" disabled>
              <i class="bi bi-x-circle mr-2"></i>Ditutup
            </button>`;
            statusHTML = `<div class="bg-gray-50 rounded-lg p-3 mb-4"><p class="text-sm text-gray-500 font-medium">⏱ Pendaftaran Ditutup</p></div>`;
          } else { // NOT_ACTIVE
            buttonHTML = `<button class="w-full bg-gray-300 text-gray-600 cursor-not-allowed font-semibold py-3 px-6 rounded-lg" disabled>
              <i class="bi bi-info-circle mr-2"></i>Belum Aktif
            </button>`;
            statusHTML = `<div class="bg-gray-50 rounded-lg p-3 mb-4"><p class="text-sm text-gray-500 font-medium">ℹ️ Belum Aktif</p></div>`;
          }
          
          // Format dates
          const startFormatted = formatDate(gelombang.start_date);
          const endFormatted = formatDate(gelombang.end_date);
          
          // Build card HTML
          cardsHTML += `
            <div class="bg-white rounded-2xl p-6 shadow-xl border-2 ${colors.border} relative overflow-hidden hover:shadow-2xl transition">
              <div class="absolute top-0 right-0 ${colors.badge} text-white px-4 py-2 rounded-bl-lg text-sm font-semibold">${gelombang._label}</div>
              <div class="text-center mt-4">
                <div class="w-16 h-16 ${colors.icon} rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                  <i class="bi bi-calendar-check text-white text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold mb-2 text-gray-800">${gelombang.nama}</h3>
                <div class="space-y-2 mb-4">
                  <div class="flex items-center justify-center text-gray-600">
                    <i class="bi bi-calendar-event mr-2 ${colors.iconText}"></i>
                    <span class="text-sm">${startFormatted} - ${endFormatted}</span>
                  </div>
                  <div class="flex items-center justify-center text-gray-600">
                    <i class="bi bi-mortarboard mr-2 ${colors.iconText}"></i>
                    <span class="text-sm font-semibold">Tahun Ajaran ${gelombang.tahun_ajaran}</span>
                  </div>
                </div>
                ${statusHTML}
                ${buttonHTML}
              </div>
            </div>
          `;
        });
        
        // Render all cards in grid
        container.innerHTML = cardsHTML;
        
      } catch (error) {
        console.error('[GELOMBANG_LIST] Error:', error);
        document.getElementById('gelombangContainer').innerHTML = `
          <div class="text-center py-12 col-span-full">
            <i class="bi bi-exclamation-triangle text-red-500 text-4xl mb-3"></i>
            <p class="text-gray-600">Gagal memuat data gelombang. Silakan refresh halaman.</p>
          </div>
        `;
      }
    }

    function formatDate(dateString) {
      const options = { day: 'numeric', month: 'long', year: 'numeric' };
      const date = new Date(dateString);
      return date.toLocaleDateString('id-ID', options);
    }

    // Load active gelombang when page loads
    document.addEventListener('DOMContentLoaded', loadGelombangAktif);
    
    // Load Why Section content
    async function loadWhySection() {
      try {
        console.log('[WHY_SECTION] Loading Why Section content...');
        
        const response = await fetch('/api/why_section_list');
        const result = await response.json();
        
        if (!result.ok || !result.data) {
          console.error('[WHY_SECTION] Failed to load content');
          return;
        }
        
        const container = document.getElementById('whySectionContent');
        if (!container) return;
        
        const data = result.data;
        
        // Modern 2-column layout: Title left, Card right
        container.innerHTML = `
          <!-- Left Column: Title -->
          <div class="flex flex-col justify-center">
            <h2 class="text-4xl lg:text-5xl xl:text-6xl font-bold text-brand-800 leading-tight mb-4 lg:mb-0">
              ${data.title || 'Mengapa Memilih Pondok Pesantren Al Ikhsan Beji?'}
            </h2>
          </div>
          
          <!-- Right Column: Card with Subtitle + Content -->
          <div class="relative">
            <div class="bg-gradient-to-br from-brand-50 to-white border-l-4 border-brand-600 rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 p-8 lg:p-10">
              ${data.subtitle ? `
                <div class="flex items-start mb-6">
                  <div class="flex-shrink-0 w-12 h-12 bg-brand-600 rounded-lg flex items-center justify-center mr-4">
                    <i class="bi bi-star-fill text-white text-xl"></i>
                  </div>
                  <div class="flex-1">
                    <h3 class="text-xl lg:text-2xl font-semibold text-brand-900 mb-2">
                      ${data.subtitle}
                    </h3>
                  </div>
                </div>
              ` : ''}
              
              <div class="prose prose-lg max-w-none">
                <p class="text-gray-700 leading-relaxed whitespace-pre-line text-justify">
                  ${data.content || ''}
                </p>
              </div>
              
              <!-- Decorative element -->
              <div class="absolute -bottom-4 -right-4 w-24 h-24 bg-brand-100 rounded-full opacity-20 blur-2xl"></div>
            </div>
          </div>
        `;
        
        console.log('[WHY_SECTION] ✅ Content loaded successfully');
        
      } catch (error) {
        console.error('[WHY_SECTION] Error:', error);
        const container = document.getElementById('whySectionContent');
        if (container) {
          container.innerHTML = `
            <!-- Left Column: Title -->
            <div class="flex flex-col justify-center">
              <h2 class="text-4xl lg:text-5xl xl:text-6xl font-bold text-brand-800 leading-tight mb-4 lg:mb-0">
                Mengapa Memilih Pondok Pesantren Al Ikhsan Beji?
              </h2>
            </div>
            
            <!-- Right Column: Card -->
            <div class="relative">
              <div class="bg-gradient-to-br from-brand-50 to-white border-l-4 border-brand-600 rounded-2xl shadow-lg p-8 lg:p-10">
                <h3 class="text-xl lg:text-2xl font-semibold text-brand-900 mb-4">
                  Pendidikan islami terpadu: tahfidz Al-Qur'an, akhlak mulia, dan ilmu pengetahuan
                </h3>
                <p class="text-gray-700 leading-relaxed">
                  Bergabunglah dengan Pondok Pesantren Al Ikhsan Beji untuk mendapatkan pendidikan islami terpadu yang membentuk karakter santri yang berakhlak mulia.
                </p>
              </div>
            </div>
          `;
        }
      }
    }
    
    // Load Why Section on page load
    document.addEventListener('DOMContentLoaded', loadWhySection);
    
    // ===== REAL-TIME SYNC WITH ADMIN =====
    
    // Method 1: Listen for changes from admin panel via localStorage (cross-tab)
    window.addEventListener('storage', function(e) {
      if (e.key === 'gelombang_update') {
        try {
          const update = JSON.parse(e.newValue);
          console.log('[GELOMBANG] 📡 Received update from admin (storage event):', update);
          console.log('[GELOMBANG] 🔄 Reloading gelombang display...');
          
          // Show toast notification to user
          if (typeof toastr !== 'undefined' && toastr.info) {
            toastr.info('Data gelombang diperbarui!');
          }
          
          // Reload with slight delay to ensure DB is updated
          setTimeout(() => {
            loadGelombangAktif();
          }, 500);
        } catch (err) {
          console.log('[GELOMBANG] Admin updated gelombang (legacy format), reloading...');
          setTimeout(() => {
            loadGelombangAktif();
          }, 500);
        }
      }
    });
    
    // Method 2: Listen for custom event (same-window sync - if admin in iframe)
    window.addEventListener('gelombangUpdated', function(e) {
      console.log('[GELOMBANG] 📡 Received update (custom event):', e.detail);
      console.log('[GELOMBANG] 🔄 Reloading gelombang display...');
      
      setTimeout(() => {
        loadGelombangAktif();
      }, 500);
    });
    
    // Method 3: Periodic polling as fallback (every 60 seconds)
    setInterval(() => {
      console.log('[GELOMBANG] 🔄 Periodic refresh (fallback)...');
      loadGelombangAktif();
    }, 60000); // 60 seconds
  </script>
  
  <!-- Supabase Real-Time Sync (Optional - for cross-tab/cross-device sync) -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    
    // Initialize Supabase client (same credentials as admin)
    const SUPABASE_URL = 'https://sxbvadzcwpaovkhghttv.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN4YnZhZHpjd3Bhb3ZraGdodHR2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExMDg4MDYsImV4cCI6MjA3NjY4NDgwNn0.miJeKmsNgjgS4fWegGlwrxF_cPUoZBT0YKl1oxmmXTE';
    
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    
    console.log('[SUPABASE INDEX] ✅ Client initialized for real-time sync');
    
    // Subscribe to gelombang table changes (real-time across devices)
    const channel = supabase
      .channel('gelombang-changes-public')
      .on('postgres_changes', { 
        event: '*', 
        schema: 'public', 
        table: 'gelombang' 
      }, (payload) => {
        console.log('[SUPABASE INDEX] 🔄 Gelombang data changed:', payload);
        console.log('[SUPABASE INDEX] Event type:', payload.eventType);
        
        // Show notification to user
        if (typeof toastr !== 'undefined' && toastr.info) {
          toastr.info('📊 Data gelombang diperbarui dari server');
        }
        
        // Reload immediately (database already consistent)
        setTimeout(() => {
          console.log('[SUPABASE INDEX] 🔄 Reloading gelombang display from Supabase event...');
          if (typeof loadGelombangAktif === 'function') {
            loadGelombangAktif();
          }
        }, 300);
      })
      .subscribe((status) => {
        if (status === 'SUBSCRIBED') {
          console.log('[SUPABASE INDEX] ✅ Subscribed to real-time gelombang updates');
          console.log('[SUPABASE INDEX] 🎧 Listening for database changes...');
        } else if (status === 'CLOSED') {
          console.log('[SUPABASE INDEX] ⚠️ Real-time connection closed');
        } else if (status === 'CHANNEL_ERROR') {
          console.error('[SUPABASE INDEX] ❌ Real-time connection error');
        }
        console.log('[SUPABASE INDEX] Connection status:', status);
      });
    
    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      console.log('[SUPABASE INDEX] 🔌 Unsubscribing from real-time updates');
      supabase.removeChannel(channel);
    });
  </script>
  
  <!-- Image Slider Script (Card Minimalis - Slide Animation) -->
  <script>
    /**
     * Image Slider Section (Card Minimalis dengan Slide Animation)
     * Animasi geser ke samping - NO FADE
     */
    let currentImageSlideIndex = 0;
    let imageSliderInterval = null;
    let sliderTrack = null;

    /**
     * Load images from API for slider section
     */
    async function loadImageSlider() {
      try {
        console.log('[IMAGE_SLIDER] 🚀 Starting to load images...');
        
        // Add cache buster to ensure fresh data
        const cacheBuster = new Date().getTime();
        const response = await fetch(`/api/hero_images_list?_t=${cacheBuster}`);
        console.log('[IMAGE_SLIDER] API Response status:', response.status, response.statusText);
        
        const result = await response.json();
        console.log('[IMAGE_SLIDER] API Result:', result);
        
        // Get slider track element
        sliderTrack = document.getElementById('sliderTrack');
        if (!sliderTrack) {
          console.error('[IMAGE_SLIDER] ❌ Slider track not found!');
          return;
        }
        
        if (!result.ok || !result.data || result.data.length === 0) {
          console.log('[IMAGE_SLIDER] ⚠️ No images found, keeping fallback gradient');
          // Reset position to 0
          sliderTrack.style.transform = 'translateX(0)';
          return;
        }
        
        console.log('[IMAGE_SLIDER] ✅ Found', result.data.length, 'images');
        console.log('[IMAGE_SLIDER] Image URLs:', result.data.map(img => img.image_url));
        
        // Remove fallback gradient
        const fallback = document.getElementById('sliderFallback');
        if (fallback) {
          console.log('[IMAGE_SLIDER] 🗑️ Removing fallback gradient...');
          fallback.remove();
        }
        
        // Clear track
        sliderTrack.innerHTML = '';
        console.log('[IMAGE_SLIDER] 🧹 Cleared slider track');
        
        // Create slide elements
        result.data.forEach((image, index) => {
          let cleanUrl = image.image_url;
          if (cleanUrl) {
            cleanUrl = cleanUrl.trim().replace(/\?$/, '');
          }
          
          console.log(`[IMAGE_SLIDER] 📸 Creating slide ${index} with URL:`, cleanUrl);
          
          const slideDiv = document.createElement('div');
          slideDiv.className = 'slider-slide';
          
          // Set background image - NO opacity, NO fade, just background
          slideDiv.style.backgroundImage = `url("${cleanUrl}")`;
          slideDiv.style.backgroundSize = 'cover';
          slideDiv.style.backgroundPosition = 'center';
          slideDiv.style.backgroundRepeat = 'no-repeat';
          
          slideDiv.dataset.slideIndex = index;
          slideDiv.dataset.imageUrl = cleanUrl;
          sliderTrack.appendChild(slideDiv);
          
          // Verify image loads
          const testImg = new Image();
          testImg.onload = () => {
            console.log(`[IMAGE_SLIDER] ✅ Image ${index} loaded successfully:`, cleanUrl);
          };
          testImg.onerror = () => {
            console.error(`[IMAGE_SLIDER] ❌ Image ${index} failed to load:`, cleanUrl);
          };
          testImg.src = cleanUrl;
        });
        
        // Reset to first slide
        currentImageSlideIndex = 0;
        updateSliderPosition();
        
        console.log('[IMAGE_SLIDER] 📊 Total slides created:', result.data.length);
        
        // Start auto-slider if more than 1 image
        if (result.data.length > 1) {
          startImageSlider();
          console.log('[IMAGE_SLIDER] ✅ Slider started with', result.data.length, 'images (auto-rotate every 4s - SLIDE animation)');
        } else if (result.data.length === 1) {
          console.log('[IMAGE_SLIDER] ✅ Single image loaded (no auto-slide)');
        }
        
      } catch (error) {
        console.error('[IMAGE_SLIDER] ❌ Error loading images:', error);
        console.error('[IMAGE_SLIDER] Error details:', error.message, error.stack);
      }
    }

    /**
     * Update slider position using translateX (SLIDE animation, NO FADE)
     */
    function updateSliderPosition() {
      if (!sliderTrack) return;
      
      // Calculate translateX: move track to the left by current index * 100%
      const translateX = -currentImageSlideIndex * 100;
      sliderTrack.style.transform = `translateX(${translateX}%)`;
      
      console.log('[IMAGE_SLIDER] Position updated to index:', currentImageSlideIndex, 'translateX:', translateX + '%');
    }

    /**
     * Start auto-slider (4 seconds per slide)
     */
    function startImageSlider() {
      if (imageSliderInterval) {
        clearInterval(imageSliderInterval);
      }
      
      imageSliderInterval = setInterval(() => {
        nextImageSlide();
      }, 4000); // 4 seconds
    }

    /**
     * Move to next slide (SLIDE animation)
     */
    function nextImageSlide() {
      if (!sliderTrack) return;
      
      const slides = sliderTrack.querySelectorAll('.slider-slide');
      if (slides.length === 0) return;
      
      // Calculate next index (loop back to 0 after last)
      currentImageSlideIndex = (currentImageSlideIndex + 1) % slides.length;
      
      // Update position with slide animation (translateX)
      updateSliderPosition();
      
      console.log('[IMAGE_SLIDER] Slide changed to index:', currentImageSlideIndex);
    }

    /**
     * Stop slider
     */
    function stopImageSlider() {
      if (imageSliderInterval) {
        clearInterval(imageSliderInterval);
        imageSliderInterval = null;
        console.log('[IMAGE_SLIDER] Slider stopped');
      }
    }

    /**
     * Reset slider to first slide
     */
    function resetImageSlider() {
      currentImageSlideIndex = 0;
      updateSliderPosition();
    }

    // Load images on page load
    document.addEventListener('DOMContentLoaded', loadImageSlider);
    
    // Pause slider when page is hidden (performance optimization)
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        stopImageSlider();
      } else {
        if (sliderTrack) {
          const slides = sliderTrack.querySelectorAll('.slider-slide');
          if (slides.length > 1) {
            startImageSlider();
          }
        }
      }
    });
    
    // ===== REAL-TIME SYNC: Listen to hero_images changes =====
    window.addEventListener('load', function() {
      if (typeof supabase !== 'undefined') {
        const imageChannel = supabase
          .channel('image-slider-public')
          .on('postgres_changes', { 
            event: '*', 
            schema: 'public', 
            table: 'hero_images' 
          }, (payload) => {
            console.log('[IMAGE_SLIDER] 🔄 Images changed from admin:', payload);
            console.log('[IMAGE_SLIDER] 🔄 Reloading slider...');
            
            // Reload images
            stopImageSlider();
            setTimeout(() => {
              loadImageSlider();
            }, 500);
          })
          .subscribe((status) => {
            if (status === 'SUBSCRIBED') {
              console.log('[IMAGE_SLIDER] 🎧 Subscribed to real-time updates');
            }
          });
        
        // Cleanup
        window.addEventListener('beforeunload', () => {
          supabase.removeChannel(imageChannel);
        });
      }
    });
  </script>
</body>
</html>